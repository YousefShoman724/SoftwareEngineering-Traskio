<!DOCTYPE html>
<html>
<head>
  <title>Dashboard - Traskio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
    }

    .navbar {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 15px 30px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .navbar-brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-small {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 18px;
    }

    .brand-name {
      font-size: 24px;
      font-weight: 700;
      color: #2d3436;
    }

    .logout-btn {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
      color: white;
      border: none;
      padding: 10px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .logout-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(255, 107, 107, 0.3);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 30px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }

    .stat-card h3 {
      font-size: 14px;
      color: #636e72;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-card .number {
      font-size: 32px;
      font-weight: 700;
      color: #2d3436;
    }

    .form-card {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      margin-bottom: 30px;
    }

    .form-card h2 {
      font-size: 20px;
      color: #2d3436;
      margin-bottom: 20px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }

    .form-grid.full {
      grid-template-columns: 1fr;
    }

    .input-group {
      display: flex;
      flex-direction: column;
    }

    .input-group label {
      font-size: 13px;
      font-weight: 600;
      color: #636e72;
      margin-bottom: 6px;
    }

    .input-group input,
    .input-group select {
      padding: 12px;
      border: 2px solid #e1e8ed;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
    }

    .filter-section {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      margin-bottom: 25px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .filter-section input,
    .filter-section select {
      flex: 1;
      min-width: 200px;
      padding: 10px 14px;
      border: 2px solid #e1e8ed;
      border-radius: 8px;
      font-size: 14px;
    }

    .filter-section button {
      padding: 10px 24px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .filter-section button:hover {
      background: #5568d3;
    }

    .tasks-header {
      margin-bottom: 20px;
    }

    .tasks-header h2 {
      font-size: 24px;
      color: #2d3436;
    }

    .tasks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }

    .task-card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      border-left: 4px solid #667eea;
    }

    .task-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }

    .task-card.status-pending { border-left-color: #ffa502; }
    .task-card.status-in-progress { border-left-color: #3742fa; }
    .task-card.status-completed { border-left-color: #2ed573; }

    .task-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .task-title {
      font-size: 18px;
      font-weight: 700;
      color: #2d3436;
      margin-bottom: 4px;
    }

    .task-status-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-pending { background: #fff3cd; color: #856404; }
    .status-in-progress { background: #cce5ff; color: #004085; }
    .status-completed { background: #d4edda; color: #155724; }

    .task-description {
      color: #636e72;
      font-size: 14px;
      margin-bottom: 12px;
      line-height: 1.5;
    }

    .task-meta {
      display: flex;
      gap: 15px;
      margin-bottom: 12px;
      font-size: 13px;
      color: #636e72;
      flex-wrap: wrap;
    }

    .task-meta-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .progress-section {
      margin: 15px 0;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 13px;
      color: #636e72;
      font-weight: 600;
    }

    .progress-bar {
      height: 8px;
      background: #e1e8ed;
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      transition: width 0.5s ease;
      border-radius: 10px;
    }

    .subtasks-section {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e1e8ed;
    }

    .subtasks-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .subtasks-title {
      font-size: 14px;
      font-weight: 600;
      color: #2d3436;
    }

    .add-subtask-btn {
      background: none;
      border: none;
      color: #667eea;
      cursor: pointer;
      font-size: 20px;
      font-weight: 600;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .add-subtask-btn:hover {
      background: #667eea;
      color: white;
    }

    .subtask-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 0;
      font-size: 14px;
    }

    .subtask-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #667eea;
    }

    .subtask-text {
      flex: 1;
      color: #2d3436;
    }

    .subtask-text.completed {
      text-decoration: line-through;
      color: #b2bec3;
    }

    .subtask-delete {
      background: none;
      border: none;
      color: #ff6b6b;
      cursor: pointer;
      font-size: 16px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .subtask-item:hover .subtask-delete {
      opacity: 1;
    }

    .task-actions {
      display: flex;
      gap: 8px;
      margin-top: 15px;
    }

    .btn-small {
      flex: 1;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-edit {
      background: #3742fa;
      color: white;
    }

    .btn-edit:hover {
      background: #2f3bdc;
    }

    .btn-delete {
      background: #ff6b6b;
      color: white;
    }

    .btn-delete:hover {
      background: #ee5a6f;
    }

    .btn-save {
      background: #2ed573;
      color: white;
    }

    .btn-save:hover {
      background: #26be63;
    }

    .btn-cancel {
      background: #b2bec3;
      color: white;
    }

    .btn-cancel:hover {
      background: #95a5a6;
    }

    .task-card.editing .task-title-display,
    .task-card.editing .task-description-display,
    .task-card.editing .task-meta,
    .task-card.editing .task-status-badge {
      display: none;
    }

    .task-card:not(.editing) .task-edit-form {
      display: none;
    }

    .task-edit-form {
      margin-bottom: 12px;
    }

    .task-edit-form input,
    .task-edit-form select {
      width: 100%;
      padding: 8px;
      margin-bottom: 8px;
      border: 2px solid #e1e8ed;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.3;
    }

    .empty-state h3 {
      font-size: 20px;
      color: #2d3436;
      margin-bottom: 10px;
    }

    .empty-state p {
      color: #636e72;
      font-size: 14px;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }

      .tasks-grid {
        grid-template-columns: 1fr;
      }

      .filter-section {
        flex-direction: column;
      }

      .filter-section input,
      .filter-section select {
        width: 100%;
      }
    }

    /* New Professional Features */
    
    /* Priority Badges */
    .priority-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      margin-left: 8px;
    }

    .priority-high { background: #ff6b6b; color: white; }
    .priority-medium { background: #ffa502; color: white; }
    .priority-low { background: #4cd137; color: white; }

    /* Tags System */
    .task-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin: 10px 0;
    }

    .task-tag {
      padding: 4px 10px;
      background: #e1e8ed;
      border-radius: 12px;
      font-size: 12px;
      color: #2d3436;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .task-tag-remove {
      cursor: pointer;
      font-weight: bold;
      color: #ff6b6b;
    }

    /* Comments Section */
    .comments-section {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e1e8ed;
    }

    .comments-header {
      font-size: 14px;
      font-weight: 600;
      color: #2d3436;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .comment-item {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .comment-author {
      font-weight: 600;
      color: #667eea;
      margin-bottom: 4px;
    }

    .comment-time {
      font-size: 11px;
      color: #95a5a6;
      margin-left: 8px;
    }

    .comment-input {
      width: 100%;
      padding: 8px;
      border: 2px solid #e1e8ed;
      border-radius: 6px;
      font-size: 13px;
      margin-top: 8px;
    }

    /* Time Tracking */
    .time-tracking {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 8px;
      margin: 10px 0;
    }

    .time-tracking-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .time-badge {
      background: #667eea;
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    /* Attachments */
    .attachments-section {
      margin-top: 10px;
    }

    .attachment-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      background: #f8f9fa;
      border-radius: 6px;
      margin-bottom: 6px;
      font-size: 13px;
    }

    .attachment-icon {
      font-size: 18px;
    }

    /* Kanban View Toggle */
    .view-toggle {
      display: flex;
      gap: 10px;
      background: white;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      margin-bottom: 20px;
      align-items: center;
    }

    .view-toggle-btn {
      padding: 8px 16px;
      border: 2px solid #e1e8ed;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .view-toggle-btn.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    /* Kanban Board */
    .kanban-board {
      display: none;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    .kanban-board.active {
      display: grid;
    }

    .kanban-column {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .kanban-column-header {
      font-size: 16px;
      font-weight: 700;
      color: #2d3436;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .kanban-column-count {
      background: #e1e8ed;
      color: #2d3436;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
    }

    .kanban-task {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      border-left: 3px solid #667eea;
    }

    .kanban-task:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* Activity Log */
    .activity-log {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      margin-bottom: 20px;
      max-height: 300px;
      overflow-y: auto;
    }

    .activity-log h3 {
      font-size: 18px;
      color: #2d3436;
      margin-bottom: 15px;
    }

    .activity-item {
      display: flex;
      gap: 12px;
      padding: 10px 0;
      border-bottom: 1px solid #e1e8ed;
    }

    .activity-icon {
      width: 36px;
      height: 36px;
      background: #667eea;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }

    .activity-content {
      flex: 1;
    }

    .activity-text {
      font-size: 14px;
      color: #2d3436;
      margin-bottom: 4px;
    }

    .activity-time {
      font-size: 12px;
      color: #95a5a6;
    }

    /* Quick Actions Sidebar */
    .quick-actions {
      position: fixed;
      right: 30px;
      bottom: 30px;
      z-index: 1000;
    }

    .quick-action-btn {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
      transition: all 0.3s ease;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .quick-action-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 24px rgba(102, 126, 234, 0.6);
    }

    /* Notifications */
    .notification {
      position: fixed;
      top: 80px;
      right: 30px;
      background: white;
      padding: 16px 20px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      display: none;
      animation: slideInRight 0.3s ease-out;
      max-width: 350px;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .notification.show {
      display: block;
    }

    .notification.success {
      border-left: 4px solid #2ed573;
    }

    .notification.error {
      border-left: 4px solid #ff6b6b;
    }

    .notification.info {
      border-left: 4px solid #3742fa;
    }

    /* Search Highlight */
    .highlight {
      background: #fff3cd;
      padding: 2px 4px;
      border-radius: 3px;
    }

    /* Export Button */
    .export-btn {
      padding: 10px 20px;
      background: #2ed573;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      margin-left: auto;
    }

    .export-btn:hover {
      background: #26be63;
      transform: translateY(-2px);
    }

    /* Dark Mode Toggle */
    .theme-toggle {
      background: white;
      border: 2px solid #e1e8ed;
      padding: 8px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 20px;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      background: #f8f9fa;
    }

    /* Task Duplication */
    .btn-duplicate {
      background: #ffa502;
      color: white;
    }

    .btn-duplicate:hover {
      background: #ff8c00;
    }
    /* === Dark Mode Start === */  /* <-- Add this line faw2 kol CSS */

/* 1. Body */
body.dark-mode {
  background: #121212 !important;
  color: #eee !important;
}

/* 2. Navbar */
body.dark-mode .navbar {
  background: rgba(30, 30, 30, 0.95);
  color: #eee;
}

/* 3. Cards & Sections */
body.dark-mode .stat-card,
body.dark-mode .form-card,
body.dark-mode .filter-section,
body.dark-mode .task-card,
body.dark-mode .kanban-column,
body.dark-mode .kanban-task,
body.dark-mode .activity-log,
body.dark-mode .empty-state {
  background: #1e1e1e;
  color: #eee;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

/* 4. Inputs & Selects */
body.dark-mode input,
body.dark-mode select,
body.dark-mode .comment-input {
  background: #2a2a2a;
  color: #eee;
  border: 2px solid #444;
}

/* 5. Buttons */
body.dark-mode .btn-primary,
body.dark-mode .quick-action-btn,
body.dark-mode .export-btn,
body.dark-mode .theme-toggle,
body.dark-mode .btn-small {
  background: #667eea;
  color: white;
  border-color: #667eea;
}

/* 6. Status badges */
body.dark-mode .status-pending { background: #ffa502; color: #fff; }
body.dark-mode .status-in-progress { background: #3742fa; color: #fff; }
body.dark-mode .status-completed { background: #2ed573; color: #fff; }

/* 7. Kanban counts */
body.dark-mode .kanban-column-count {
  background: #444;
  color: #eee;
}

/* 8. Scrollbar */
body.dark-mode ::-webkit-scrollbar {
  width: 8px;
}
body.dark-mode ::-webkit-scrollbar-thumb {
  background: #555;
  border-radius: 4px;
}
body.dark-mode ::-webkit-scrollbar-track {
  background: #1e1e1e;
}

/* === Dark Mode End === */  /* <-- Add this line abl closing </style> */

  </style>
</head>
<body>

<div class="navbar">
  <div class="navbar-brand">
    <div class="logo-small">T</div>
    <span class="brand-name">Traskio</span>
  </div>
  <div style="display: flex; align-items: center; gap: 15px;">
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">üåô</button>
    <button class="export-btn" onclick="exportTasks()">üìä Export</button>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>
</div>

<div class="notification" id="notification">
  <div id="notificationText"></div>
</div>

<div class="container">
  <!-- Activity Log -->
  <div class="activity-log" id="activityLog" style="display: none;">
    <h3>üìú Recent Activity</h3>
    <div id="activityList"></div>
  </div>

  <div class="stats-grid">
    <div class="stat-card" onclick="filterByStatus('')" style="cursor: pointer;">
      <h3>Total Tasks</h3>
      <div class="number" id="totalTasks">0</div>
    </div>
    <div class="stat-card" onclick="filterByStatus('In Progress')" style="cursor: pointer;">
      <h3>In Progress</h3>
      <div class="number" id="inProgressTasks">0</div>
    </div>
    <div class="stat-card" onclick="filterByStatus('Completed')" style="cursor: pointer;">
      <h3>Completed</h3>
      <div class="number" id="completedTasks">0</div>
    </div>
    <div class="stat-card" onclick="filterByStatus('Pending')" style="cursor: pointer;">
      <h3>Pending</h3>
      <div class="number" id="pendingTasks">0</div>
    </div>
  </div>

  <div class="form-card">
    <h2>‚ûï Create New Task</h2>
    <div class="form-grid">
      <div class="input-group">
        <label>Task Title *</label>
        <input id="title" placeholder="Enter task title">
      </div>
      <div class="input-group">
        <label>Assign To</label>
        <input id="assigned_to" placeholder="Email address (optional)">
      </div>
    </div>
    <div class="form-grid full">
      <div class="input-group">
        <label>Description</label>
        <input id="desc" placeholder="Add task description...">
      </div>
    </div>
    <div class="form-grid">
      <div class="input-group">
        <label>Status</label>
        <select id="status">
          <option value="Pending">‚è≥ Pending</option>
          <option value="In Progress">üîÑ In Progress</option>
          <option value="Completed">‚úÖ Completed</option>
        </select>
      </div>
      <div class="input-group">
        <label>Deadline (optional)</label>
        <input id="deadline" type="date">
      </div>
    </div>
    <div class="form-grid">
      <div class="input-group">
        <label>Priority</label>
        <select id="priority">
          <option value="Low">üü¢ Low</option>
          <option value="Medium">üü° Medium</option>
          <option value="High">üî¥ High</option>
        </select>
      </div>
      <div class="input-group">
        <label>Tags (comma separated)</label>
        <input id="tags" placeholder="e.g., urgent, review, bug">
      </div>
    </div>
    <button class="btn-primary" onclick="addTask()">Create Task</button>
  </div>

  <!-- View Toggle -->
  <div class="view-toggle">
    <span style="font-weight: 600; color: #2d3436;">View:</span>
    <button class="view-toggle-btn active" onclick="switchView('grid')" id="gridViewBtn">üìä Grid</button>
    <button class="view-toggle-btn" onclick="switchView('kanban')" id="kanbanViewBtn">üìã Kanban</button>
    <button class="view-toggle-btn" onclick="toggleActivityLog()">üìú Activity</button>
  </div>

  <div class="filter-section">
    <input id="search" placeholder="üîç Search tasks...">
    <select id="filter-status">
      <option value="">All Status</option>
      <option value="Pending">Pending</option>
      <option value="In Progress">In Progress</option>
      <option value="Completed">Completed</option>
    </select>
    <select id="filter-priority">
      <option value="">All Priority</option>
      <option value="High">High</option>
      <option value="Medium">Medium</option>
      <option value="Low">Low</option>
    </select>
    <button onclick="applyFilter()">Apply</button>
    <button onclick="resetFilters()" style="background: #95a5a6;">Reset</button>
  </div>

  <div class="tasks-header">
    <h2>üìã Your Tasks</h2>
  </div>
  
  <!-- Grid View -->
  <div class="tasks-grid" id="tasks"></div>
  
  <!-- Kanban View -->
  <div class="kanban-board" id="kanbanBoard">
    <div class="kanban-column">
      <div class="kanban-column-header">
        <span>‚è≥ Pending</span>
        <span class="kanban-column-count" id="kanbanPendingCount">0</span>
      </div>
      <div id="kanbanPending"></div>
    </div>
    <div class="kanban-column">
      <div class="kanban-column-header">
        <span>üîÑ In Progress</span>
        <span class="kanban-column-count" id="kanbanProgressCount">0</span>
      </div>
      <div id="kanbanProgress"></div>
    </div>
    <div class="kanban-column">
      <div class="kanban-column-header">
        <span>‚úÖ Completed</span>
        <span class="kanban-column-count" id="kanbanCompletedCount">0</span>
      </div>
      <div id="kanbanCompleted"></div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="quick-actions">
  <button class="quick-action-btn" onclick="scrollToTop()" title="Scroll to Top">‚Üë</button>
  <button class="quick-action-btn" onclick="quickAddTask()" title="Quick Add Task">+</button>
</div>

<script>
let allTasks = [];
let activityLog = [];
let currentView = 'grid';

async function loadTasks(){
  let r = await fetch("/tasks");
  allTasks = await r.json();
  allTasks = allTasks.map(task => ({
    ...task, 
    subtasks: task.subtasks || [], 
    deadline: task.deadline || null,
    priority: task.priority || 'Medium',
    tags: task.tags || [],
    comments: task.comments || [],
    timeTracked: task.timeTracked || 0,
    createdAt: task.createdAt || new Date().toISOString()
  }));
  updateStats();
  if(currentView === 'grid') {
    displayTasks(allTasks);
  } else {
    displayKanban(allTasks);
  }
  updateActivityLog();
}

function updateStats() {
  const total = allTasks.length;
  const inProgress = allTasks.filter(t => t.status === 'In Progress').length;
  const completed = allTasks.filter(t => t.status === 'Completed').length;
  const pending = allTasks.filter(t => t.status === 'Pending').length;
  document.getElementById('totalTasks').textContent = total;
  document.getElementById('inProgressTasks').textContent = inProgress;
  document.getElementById('completedTasks').textContent = completed;
  document.getElementById('pendingTasks').textContent = pending;
}

function sortTasksByDeadline(tasks) {
  return tasks.sort((a, b) => {
    if(a.deadline && !b.deadline) return -1;
    if(!a.deadline && b.deadline) return 1;
    if(a.deadline && b.deadline) return new Date(a.deadline) - new Date(b.deadline);
    return a.id - b.id;
  });
}

function calculateProgress(task) {
  if(!task.subtasks || task.subtasks.length === 0) return 0;
  const completed = task.subtasks.filter(st => st.completed).length;
  return Math.round((completed / task.subtasks.length) * 100);
}

function displayTasks(tasks) {
  const container = document.getElementById("tasks");
  if (tasks.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">üì≠</div>
        <h3>No tasks found</h3>
        <p>Create your first task to get started!</p>
      </div>`;
    return;
  }
  const sortedTasks = sortTasksByDeadline([...tasks]);
  container.innerHTML = "";
  sortedTasks.forEach(task => {
    const progress = calculateProgress(task);
    const statusClass = task.status.toLowerCase().replace(' ', '-');
    const deadlineText = task.deadline ? new Date(task.deadline).toLocaleDateString() : 'No deadline';
    const daysUntil = task.deadline ? Math.ceil((new Date(task.deadline) - new Date()) / (1000 * 60 * 60 * 24)) : null;
    const priorityClass = 'priority-' + (task.priority || 'medium').toLowerCase();
    const card = document.createElement('div');
    card.className = 'task-card status-' + statusClass;
    card.id = 'task-' + task.id;
card.innerHTML = `
      <div class="task-header">
        <div>
          <div class="task-title-display task-title"> ${task.title} <span class="priority-badge ${priorityClass}">${task.priority || 'Medium'}</span>
          </div>
          <div class="task-edit-form">
            <input type="text" value="${task.title}" id="edit-title-${task.id}">
          </div>
        </div>
        <span class="task-status-badge status-${statusClass}">${task.status}</span>
      </div>

      ${task.tags && task.tags.length > 0 ? `
        <div class="task-tags">
          ${task.tags.map(tag => `<span class="task-tag">#${tag}</span>`).join('')}
        </div>` : ''}

      <div class="task-description-display task-description">${task.description || 'No description'}</div>

      <div class="task-edit-form">
        <input type="text" value="${task.description || ''}" id="edit-desc-${task.id}" placeholder="Description">
        <input type="text" value="${task.assigned_to}" id="edit-assign-${task.id}" placeholder="Assign to">
        <input type="date" value="${task.deadline || ''}" id="edit-deadline-${task.id}">
        <select id="edit-status-${task.id}">
          <option value="Pending" ${task.status === 'Pending' ? 'selected' : ''}>Pending</option>
          <option value="In Progress" ${task.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
          <option value="Completed" ${task.status === 'Completed' ? 'selected' : ''}>Completed</option>
        </select>
        <select id="edit-priority-${task.id}">
          <option value="High" ${task.priority === 'High' ? 'selected' : ''}>High</option>
          <option value="Medium" ${task.priority === 'Medium' ? 'selected' : ''}>Medium</option>
          <option value="Low" ${task.priority === 'Low' ? 'selected' : ''}>Low</option>
        </select>
      </div>

      <div class="task-meta">
        <div class="task-meta-item">üìÖ ${deadlineText}</div>
        ${daysUntil !== null ? `<div class="task-meta-item">${daysUntil > 0 ? '‚è∞ ' + daysUntil + ' days left' : daysUntil === 0 ? 'üî• Due today!' : '‚ùó Overdue'}</div>` : ''}
        <div class="task-meta-item">üë§ ${task.assigned_to}</div>
      </div>

      ${task.subtasks && task.subtasks.length > 0 ? `
        <div class="progress-section">
          <div class="progress-header">
            <span>Progress</span>
            <span>${progress}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${progress}%"></div>
          </div>
        </div>` : ''}

      <div class="subtasks-section">
        <div class="subtasks-header">
          <span class="subtasks-title">Sub-tasks (${task.subtasks ? task.subtasks.length : 0})</span>
          <button class="add-subtask-btn" onclick="addSubtask(${task.id})" title="Add sub-task">+</button>
        </div>
        <div id="subtasks-${task.id}">
          ${task.subtasks ? task.subtasks.map((st, idx) => `
            <div class="subtask-item">
              <input type="checkbox" class="subtask-checkbox" ${st.completed ? 'checked' : ''} onchange="toggleSubtask(${task.id}, ${idx})">
              <span class="subtask-text ${st.completed ? 'completed' : ''}">${st.text}</span>
              <button class="subtask-delete" onclick="deleteSubtask(${task.id}, ${idx})">√ó</button>
            </div>`).join('') : ''}
        </div>
      </div>

      <div class="comments-section">
        <div class="comments-header">üí¨ Comments (${task.comments ? task.comments.length : 0})</div>
        ${task.comments && task.comments.length > 0 ? task.comments.map(c => `
          <div class="comment-item">
            <div class="comment-author">${c.author}<span class="comment-time">${new Date(c.time).toLocaleString()}</span></div>
            ${c.text}
          </div>`).join('') : ''}
        <input type="text" class="comment-input" placeholder="Add a comment..." onkeypress="if(event.key==='Enter') addComment(${task.id}, this.value, event)">
      </div>

      <div class="task-actions">
        <button class="btn-small btn-edit" onclick="editTask(${task.id})">Edit</button>
        <button class="btn-small btn-duplicate" onclick="duplicateTask(${task.id})">Duplicate</button>
        <button class="btn-small btn-delete" onclick="deleteTask(${task.id})">Delete</button>
        <button class="btn-small btn-save" onclick="updateTask(${task.id})" style="display:none;">Save</button>
        <button class="btn-small btn-cancel" onclick="cancelEdit(${task.id})" style="display:none;">Cancel</button>
      </div>
    `;
   container.appendChild(card);
  });
}

function applyFilter(){
  const searchVal = document.getElementById("search").value.toLowerCase();
  const statusVal = document.getElementById("filter-status").value;
  const priorityVal = document.getElementById("filter-priority").value;
  const filtered = allTasks.filter(task=>{
    const matchesSearch = task.title.toLowerCase().includes(searchVal) || (task.description || '').toLowerCase().includes(searchVal);
    const matchesStatus = statusVal ? task.status === statusVal : true;
    const matchesPriority = priorityVal ? task.priority === priorityVal : true;
    return matchesSearch && matchesStatus && matchesPriority;
  });
  if(currentView === 'grid') {
    displayTasks(filtered);
  } else {
    displayKanban(filtered);
  }
}

function resetFilters(){
  document.getElementById("search").value = '';
  document.getElementById("filter-status").value = '';
  document.getElementById("filter-priority").value = '';
  if(currentView === 'grid') {
    displayTasks(allTasks);
  } else {
    displayKanban(allTasks);
  }
}

function filterByStatus(status){
  document.getElementById("filter-status").value = status;
  applyFilter();
}

async function addTask(){
  let title = document.getElementById("title").value;
  let desc = document.getElementById("desc").value;
  let assigned_to = document.getElementById("assigned_to").value;
  let status = document.getElementById("status").value;
  let deadline = document.getElementById("deadline").value;
  let priority = document.getElementById("priority").value;
  let tagsInput = document.getElementById("tags").value;
  let tags = tagsInput ? tagsInput.split(',').map(t => t.trim()) : [];
  if(!title) return showNotification("Title required", "error");
  await fetch("/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body: JSON.stringify({title, description:desc, assigned_to, status, deadline: deadline || null, priority, tags, createdAt: new Date().toISOString()})});
  document.getElementById("title").value="";
  document.getElementById("desc").value="";
  document.getElementById("assigned_to").value="";
  document.getElementById("status").value="Pending";
  document.getElementById("deadline").value="";
  document.getElementById("priority").value="Medium";
  document.getElementById("tags").value="";
  logActivity('Created task: ' + title);
  showNotification("Task created successfully!", "success");
  loadTasks();
}

function editTask(id){
  const card = document.getElementById('task-' + id);
  card.classList.add('editing');
  card.querySelector('.btn-edit').style.display = 'none';
  card.querySelector('.btn-delete').style.display = 'none';
  card.querySelector('.btn-save').style.display = 'inline-block';
  card.querySelector('.btn-cancel').style.display = 'inline-block';
}

function cancelEdit(id){
  loadTasks();
}

async function updateTask(id){
  let title = document.getElementById('edit-title-' + id).value;
  let desc = document.getElementById('edit-desc-' + id).value;
  let assigned_to = document.getElementById('edit-assign-' + id).value;
  let status = document.getElementById('edit-status-' + id).value;
  let deadline = document.getElementById('edit-deadline-' + id).value;
  let priority = document.getElementById('edit-priority-' + id).value;
  await fetch('/tasks/' + id,{method:"PUT",headers:{"Content-Type":"application/json"},body: JSON.stringify({title, description:desc, assigned_to, status, deadline: deadline || null, priority})});
  logActivity('Updated task: ' + title);
  showNotification("Task updated!", "success");
  loadTasks();
}

async function duplicateTask(id){
  const task = allTasks.find(t => t.id === id);
  if(!task) return;
  await fetch("/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body: JSON.stringify({title: task.title + ' (Copy)', description: task.description, assigned_to: task.assigned_to, status: 'Pending', deadline: task.deadline, priority: task.priority, tags: task.tags})});
  logActivity('Duplicated task: ' + task.title);
  showNotification("Task duplicated!", "success");
  loadTasks();
}

async function addComment(taskId, text, event){
  if(!text.trim()) return;
  const task = allTasks.find(t => t.id === taskId);
  if(!task) return;
  if(!task.comments) task.comments = [];
  const userEmail = await getCurrentUserEmail();
  task.comments.push({author: userEmail, text: text, time: new Date().toISOString()});
  await fetch('/tasks/' + taskId, {method: "PUT", headers: {"Content-Type": "application/json"}, body: JSON.stringify({title: task.title, description: task.description, assigned_to: task.assigned_to, status: task.status, deadline: task.deadline, subtasks: task.subtasks, comments: task.comments, priority: task.priority, tags: task.tags})});
  event.target.value = '';
  logActivity('Added comment to: ' + task.title);
  loadTasks();
}

async function getCurrentUserEmail(){
  try {
    const r = await fetch("/me");
    const data = await r.json();
    return data.email || 'User';
  } catch(e) {
    return 'User';
  }
}

function displayKanban(tasks){
  const pending = tasks.filter(t => t.status === 'Pending');
  const progress = tasks.filter(t => t.status === 'In Progress');
  const completed = tasks.filter(t => t.status === 'Completed');
  document.getElementById('kanbanPendingCount').textContent = pending.length;
  document.getElementById('kanbanProgressCount').textContent = progress.length;
  document.getElementById('kanbanCompletedCount').textContent = completed.length;
  renderKanbanColumn('kanbanPending', pending);
  renderKanbanColumn('kanbanProgress', progress);
  renderKanbanColumn('kanbanCompleted', completed);
}

function renderKanbanColumn(containerId, tasks){
  const container = document.getElementById(containerId);
  container.innerHTML = tasks.map(t => '<div class="kanban-task" onclick="viewTaskDetails(' + t.id + ')"><div style="font-weight:700; margin-bottom: 8px;">' + t.title + '</div><div style="font-size: 12px; color: #636e72;">üìÖ ' + (t.deadline ? new Date(t.deadline).toLocaleDateString() : 'No deadline') + '</div><div style="font-size: 12px; color: #636e72; margin-top: 4px;">üë§ ' + t.assigned_to + '</div></div>').join('');
}

function viewTaskDetails(id){
  const task = allTasks.find(t => t.id === id);
  if(task) {
    document.getElementById('task-' + id).scrollIntoView({behavior: 'smooth', block: 'center'});
  }
}

function switchView(view){
  currentView = view;
  document.getElementById('gridViewBtn').classList.toggle('active', view === 'grid');
  document.getElementById('kanbanViewBtn').classList.toggle('active', view === 'kanban');
  document.getElementById('tasks').style.display = view === 'grid' ? 'grid' : 'none';
  document.getElementById('kanbanBoard').classList.toggle('active', view === 'kanban');
  if(view === 'kanban') {
    displayKanban(allTasks);
  } else {
    displayTasks(allTasks);
  }
}

function toggleActivityLog(){
  const log = document.getElementById('activityLog');
  log.style.display = log.style.display === 'none' ? 'block' : 'none';
}

function logActivity(text){
  activityLog.unshift({text, time: new Date().toISOString(), icon: '‚úì'});
  if(activityLog.length > 20) activityLog = activityLog.slice(0, 20);
  localStorage.setItem('traskio_activity', JSON.stringify(activityLog));
}

function updateActivityLog(){
  const saved = localStorage.getItem('traskio_activity');
  if(saved) activityLog = JSON.parse(saved);
  const container = document.getElementById('activityList');
  container.innerHTML = activityLog.map(a => '<div class="activity-item"><div class="activity-icon">' + a.icon + '</div><div class="activity-content"><div class="activity-text">' + a.text + '</div><div class="activity-time">' + new Date(a.time).toLocaleString() + '</div></div></div>').join('');
}

function showNotification(text, type){
  const notif = document.getElementById('notification');
  document.getElementById('notificationText').textContent = text;
  notif.className = 'notification show ' + type;
  setTimeout(() => notif.classList.remove('show'), 3000);
}

function exportTasks(){
  const csv = 'Title,Description,Status,Priority,Deadline,Assigned To\n' + allTasks.map(t => '"' + t.title + '","' + (t.description || '') + '","' + t.status + '","' + (t.priority || 'Medium') + '","' + (t.deadline || '') + '","' + t.assigned_to + '"').join('\n');
  const blob = new Blob([csv], {type: 'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'traskio_tasks_' + new Date().toISOString().split('T')[0] + '.csv';
  a.click();
  showNotification("Tasks exported!", "success");
}

function toggleTheme() {
  const body = document.body;  // <-- line 1: get body element
  const themeBtn = document.querySelector('.theme-toggle');  // <-- line 2: get the button

  body.classList.toggle('dark-mode'); // <-- line 3: toggle dark mode class

  const isDark = body.classList.contains('dark-mode'); // <-- line 4: check if dark
  themeBtn.textContent = isDark ? '‚òÄÔ∏è' : 'üåô'; // <-- line 5: change icon
}


function quickAddTask(){
  const title = prompt('Quick add task:');
  if(!title) return;
  fetch("/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body: JSON.stringify({title, description:'', assigned_to:'', status:'Pending', deadline: null, priority: 'Medium', tags: []})}).then(() => {
    showNotification("Task added!", "success");
    logActivity('Quick added: ' + title);
    loadTasks();
  });
}

function scrollToTop(){
  window.scrollTo({top: 0, behavior: 'smooth'});
}

async function deleteTask(id){
  if(!confirm('Are you sure?')) return;
  await fetch('/tasks/' + id,{method:"DELETE"});
  loadTasks();
}

async function addSubtask(taskId) {
  const subtaskText = prompt('Enter sub-task:');
  if(!subtaskText) return;
  const task = allTasks.find(t => t.id === taskId);
  if(!task) return;
  if(!task.subtasks) task.subtasks = [];
  task.subtasks.push({text: subtaskText, completed: false});
  await fetch('/tasks/' + taskId, {method: "PUT", headers: {"Content-Type": "application/json"}, body: JSON.stringify({title: task.title, description: task.description, assigned_to: task.assigned_to, status: task.status, deadline: task.deadline, subtasks: task.subtasks})});
  loadTasks();
}

async function toggleSubtask(taskId, subtaskIdx) {
  const task = allTasks.find(t => t.id === taskId);
  if(!task || !task.subtasks[subtaskIdx]) return;
  task.subtasks[subtaskIdx].completed = !task.subtasks[subtaskIdx].completed;
  await fetch('/tasks/' + taskId, {method: "PUT", headers: {"Content-Type": "application/json"}, body: JSON.stringify({title: task.title, description: task.description, assigned_to: task.assigned_to, status: task.status, deadline: task.deadline, subtasks: task.subtasks})});
  loadTasks();
}

async function deleteSubtask(taskId, subtaskIdx) {
  const task = allTasks.find(t => t.id === taskId);
  if(!task) return;
  task.subtasks.splice(subtaskIdx, 1);
  await fetch('/tasks/' + taskId, {method: "PUT", headers: {"Content-Type": "application/json"}, body: JSON.stringify({title: task.title, description: task.description, assigned_to: task.assigned_to, status: task.status, deadline: task.deadline, subtasks: task.subtasks})});
  loadTasks();
}

async function logout(){
  await fetch("/logout");
  location="/";
}

loadTasks();
</script>

</body>
</html>